
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>퀘스트 상세 • 로나월드</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Apple SD Gothic Neo", "Malgun Gothic", sans-serif; }
  .card { border:1px solid #e5e7eb; border-radius:0.75rem; background:#fff; padding:1rem; }
  .muted { color:#6b7280; }
  .row { display:flex; align-items:center; gap:.75rem; }
  .grid { display:grid; gap:1rem; }
  img { max-width:100%; height:auto; }
  .thumb { width:56px; height:56px; object-fit:contain; background:#fff; border:1px solid #e5e7eb; border-radius:0.5rem; padding:4px; }
  .ibox { display:flex; align-items:center; gap:.75rem; padding:.5rem; border:1px solid #e5e7eb; border-radius:0.75rem; background:#fff; }
  .ibox:hover { background:#f9fafb; }

  /* Speech bubbles */
  .bubble{position:relative;max-width:80%;padding:.625rem .75rem;border-radius:1rem;line-height:1.45;box-shadow:0 1px 2px rgba(0,0,0,.06)}
  .bubble-left{background:#f8fafc;border:1px solid #e5e7eb;color:#111827}
  .bubble-right{background:#3b82f6;border:1px solid #1d4ed8;color:#fff}
  .bubble-left:after{content:"";position:absolute;left:-6px;top:12px;border-width:6px;border-style:solid;border-color:transparent #e5e7eb transparent transparent}
  .bubble-left:before{content:"";position:absolute;left:-5px;top:12px;border-width:6px;border-style:solid;border-color:transparent #f8fafc transparent transparent}
  .bubble-right:after{content:"";position:absolute;right:-6px;top:12px;border-width:6px;border-style:solid;border-color:transparent transparent transparent #1d4ed8}
  .bubble-right:before{content:"";position:absolute;right:-5px;top:12px;border-width:6px;border-style:solid;border-color:transparent transparent transparent #3b82f6}
  .bubble-name{font-weight:600;font-size:.875rem;margin-bottom:.125rem}
  .avatar{width:40px;height:40px;border-radius:9999px;border:1px solid #e5e7eb;object-fit:cover;background:#fff}
  .bubble-right .bubble-name{color:#eaf2ff}
  .bubble-right a{color:#fff;text-decoration:underline}
  .bubble-right b,.bubble-right strong{color:#fff}
</style>
</head>
<body class="bg-gray-50 text-gray-900">
<div class="mx-auto max-w-5xl p-4 sm:p-6 lg:p-8">
<a class="inline-flex items-center gap-1 text-sm mb-4 text-blue-600 hover:underline" href="index.html?tab=quests" id="back-to-quests">← 퀘스트 목록으로</a>
<article id="detail"></article>
</div>

<script>
(() => {
  'use strict';
  const IMG = {
    bruce: "https://drive.google.com/thumbnail?id=192LWAkab2bHFBmoP1O_Dj0trz0x2-MKj&sz=w256",
    iyan: "https://drive.google.com/thumbnail?id=1Qh6RmsnBctbFC6zhtyAVOFCUVMPYiJtw&sz=w256",
    henesys: "https://drive.google.com/thumbnail?id=1-mGJYGjekTQwGtgcRY5ip2iL1D7uXp7E&sz=1700x668",
    perion: "https://drive.google.com/thumbnail?id=1nbA7-aR6XfVWbgFVh6jJo7czfta-LmDt&sz=1700x668",
    toy: "https://drive.google.com/thumbnail?id=1BwyPTo3zGoZK_9U3m0XE7WZpNe2KQyCJ&sz=w256",
  };

  const q = {
  "id": "21705",
  "code": "아란 6-1",
  "title": "빅토리아 아일랜드로",
  "type": "대화",
  "region": "리엔",
  "minLevel": 10,
  "start": {
    "npc": {
      "name": "리린",
      "img": "https://drive.google.com/thumbnail?id=1gmTm8r-9Jf9dru1TOsTAWRaCueh3tvb4&sz=w400",
      "id": "1201000"
    },
    "place": {
      "name": "리엔",
      "img": "https://drive.google.com/thumbnail?id=1-Vur3U1Jw-nQaOLTLIHEOuPkcR5E4EWY&sz=w800",
      "code": "1201000"
    }
  },
  "finish": {
    "npc": {
      "name": "트루",
      "img": "https://drive.google.com/thumbnail?id=1zBYuyLSpPzu5TN_VeSYOcGv8utbMOnCV&sz=w400",
      "id": "1002104"
    },
    "place": {
      "name": "리스항구 정보상점",
      "img": "https://drive.google.com/thumbnail?id=14oqcw8cbRUt8UY7IUtRKnBzDFW5tpxdS&sz=w800",
      "code": "104000004"
    }
  },
  "dialogues": [
    {
      "who": "리린",
      "text": "강해지기 위해서는 더 많은 것을 보고 배우고 당신에게는 낯설기만 한 이 세계를 배우셔야 해요. 그러기 위해서는 이 섬을 그만 떠나셔야 할 것 같아요. 리엔에서만 있어서는 강해질 수 없으니까요."
    },
    {
      "who": "리린",
      "text": "빅토리아 아일랜드로 가세요. 그곳에서 더 많은 사람을 만나고 더 많은 몬스터와 전투를 하며 더 많은 세상을 배우세요. 기억을 잃은 만큼 더 많은 경험을 쌓으세요. 검은 마법사와 다시 마주쳐도 두려움 없을 수 있도록..."
    },
    {
      "who": "리린",
      "text": "마침 당신에게 도움을 드릴 적당한 사람이 빅토리아 아일랜드에 한 명 있어요. 진실 아저씨... 아니, 바깥식 이름으로 트루라고 하던가... 리스항구에서 정보상인을 하고 계시다고 들었어요. 이 펴닞를 가져가시면 당신을 알아보실 거예요."
    },
    {
      "who": "리린",
      "text": "빅토리아 아일랜드의 리스항구로 가는 법은 간단해요. 마을에서 오른쪽으로 나간 후, 눈 덮인 숲을 지나면 펭귄들이 운행하는 작은 항구가 있는데, 그 곳에서 푸로에게 말을 걸어 배를 타면 돼요."
    },
    {
      "who": "리린",
      "text": "처음이시니 배 값은 받지 말도록 푸로에게 미리 말해놓았어요. 배를 타고 리스항구에 도착 하시거든 리스항구정보상점을 찾으세요. 그곳에 바로 트루 아저씨가 계실 거예요."
    }
  ],
  "completionDialogues": [
    {
      "who": "트루",
      "text": "정보를 사러 오신 분인가? 응? 이건... 리린의 편지? 당신은 리엔에서 온 사람인가? 하지만 그곳에 리린 외에 사람이 있을 리가 없는데... 외부인? 아니, 그런 척박한 곳에 외부인이 올 리도 없지... 도대체 뭐지? 잠깐만 편지를 읽어보지"
    },
    {
      "who": "트루",
      "text": "... 설마하니 영웅이 정말 돌아올 줄이야. 나 역시 그 섬에 살던 사람이고, 한때는 예언을 믿었찌만... 믿겨지지 않아. 리린의 마음이 결국 보답을 받았군... 무슨 말이냐고?"
    },
    {
      "who": "트루",
      "text": "예언을 발견한 후, 수백년 동안이나 우리의 일족은 영웅이 돌아오길 기다렸어. 그 얼음밖에 없는 작은 섬에서... 하지만 영웅은 돌아오지 않았고, 예언에 대한 믿음은 점점 사라졌어."
    },
    {
      "who": "트루",
      "text": "결국 사람들은 리엔을 떠났어. 언제까지고 허황된 영웅 전설만을 믿을 수는 없잖아? 살 길을 찾아 떠난 것이니 비난하지는 말아줬으면 좋겠군. 하지만..."
    },
    {
      "who": "트루",
      "text": "리린만은 결코 리엔을 떠날 수 없다고 말했어. 영웅은 언젠가 돌아올 거라며, 혼자서라도 섬을 지키겠다고 말했다. 그 애의 오빠가 떠나는 순간에도 말이야. 정말 고집이 센 아이야."
    },
    {
      "who": "트루",
      "text": "하지만 당신이 왔으니 그 고집은 믿음이 되었군... 돌아와줘서 고마워, 영웅님. 이제야 리린을 볼 낯이 서네. 그 아이의 친척이면서도 아무 도움도 주지 못하고 있었으니..."
    },
    {
      "who": "트루",
      "text": "뭐든 말해. 얼마든지 도와주지. 영웅에게라면 당연한 일이고, 리린의 은인에게라면 더욱 당연한 일이지."
    }
  ],
  "descHtml": "리린은 리엔에서만 있어서는 강해질 수 없다며 빅토리아 아일랜드로 가라고 말했다. 그곳에서 수련을 하며 세상이 어떻게 돌아가는지도 배우라는데... 마침 도와줄 사람이 있다니, 리스항구 정보상점으로 가서 정보상인 트루라는 자를 만나자. 리스항구로 가려면 먼저 배를 타고 리엔을 벗어나야 한다. 마을에서 오른쪽으로 나가 눈 덮인 벌판을 지나면, 펭귄들의 작은 항구가 있다고 한다. 그곳에서 선원 펭귄 푸로에게 말을 걸면 배에 태워줄 것이다.",
  "reqs": [],
  "tips": [],
  "rewards": [
    {
      "exp": 3500,
      "img": "https://drive.google.com/thumbnail?id=1O9FuxyZEG_nZVJikWShUPKvb5zCH7t-z&sz=w400"
    }
  ],
  "prereqs": [
    {
      "id": "21700",
      "title": "새로운 시작"
    }
  ],
  "followups": [],
  "nexts": [ { "id": "21706", "title": "정보원의 일" } ]
};

  const img = (src, alt='', cls='') => `<img src="${src||''}" alt="${alt||''}" ${cls?`class="${cls}"`:''} onerror="this.style.display='none'">`;

  const row = (labelLeft, imgLeft, nameLeft, labelRight, imgRight, nameRight, linkLeft='', linkRight='') => {
    const cell = (label, imgSrc, name, link) => {
      const inner = `${img(imgSrc, name)}<div class="text-sm"><div class="muted">${label}</div><div class="font-medium">${name||'-'}</div></div>`;
      return link ? `<a class="row" href="${link}">${inner}</a>` : `<div class="row">${inner}</div>`;
    };
    return `<div class="row">${cell(labelLeft, imgLeft, nameLeft, linkLeft)}<div class="muted" style="padding:0 .5rem">|</div>${cell(labelRight, imgRight, nameRight, linkRight)}</div>`;
  };

  const rewardBox = r => {
    if (typeof r.exp === 'number') {
      const pic = img(r.img, 'EXP', 'thumb');
      const txt = `<div class="text-sm font-medium">경험치 ${r.exp.toLocaleString()} exp</div>`;
      return `<div class="ibox">${pic}${txt}</div>`;
    }
    const title = `${r.name||''}${(r.qty && r.qty>0) ? ' ×'+r.qty : ''}`;
    const pic = img(r.img, r.name, 'thumb');
    const inner = `<div class="text-sm font-medium">${title}</div>`;
    return r.itemId ? `<a class="ibox" href="https://linsuol13-bit.github.io/LO/item-${r.itemId}.html">${pic}${inner}</a>` : `<div class="ibox">${pic}${inner}</div>`;
  };

  
const reqItemBox = r => {
  const qtyPart = (r.qty && r.qty>0) ? (' ×'+r.qty) : (r.qty===0 ? ' (전달)' : (r.qty<0 ? ' (사용)' : ''));
  const title = `${r.name}${qtyPart}`;
  const pic = img(r.img, r.name, 'thumb');
  const inner = `<div class="text-sm font-medium">${title}</div>`;
  let href = '';
  if (r.itemId) {
    const t = (r.type||'');
    if (t.includes('몬스터')) href = `https://linsuol13-bit.github.io/LO/monster-${r.itemId}.html`;
    else if (t.includes('아이템')) href = `https://linsuol13-bit.github.io/LO/item-${r.itemId}.html`;
  }
  return href ? `<a class="ibox" href="${href}">${pic}${inner}</a>` : `<div class="ibox">${pic}${inner}</div>`;
};
        

  const isPlayer = (w) => /^(나|플레이어|주인공|Player|영웅)$/i.test((w||'').toString().trim());
  const avatarFor = (who) => {
    if (who === (q.start.npc && q.start.npc.name)) return q.start.npc.img;
    if (who === (q.finish.npc && q.finish.npc.name)) return q.finish.npc.img;
    return '';
  };
  const dialogueRow = (d) => {
    d = d || { };
    const left = !isPlayer(d.who);
    const av = left ? avatarFor(d.who) : '';
    const avatar = (left && av) ? `<img class="avatar" src="${av}" alt="${d.who||''}" onerror="this.style.display='none'">` : '';
    return `<div class="flex items-start ${left ? 'justify-start' : 'justify-end'} gap-2">${left ? avatar : ''}<div class="bubble ${left ? 'bubble-left' : 'bubble-right'}"><div class="bubble-name">${d.who||''}</div><div class="text-sm leading-snug">${d.text||''}</div></div></div>`;
  };

  const tipsSection = (tips=[]) => {
    const list = Array.isArray(tips) ? tips : [];
    if (!list.length) return '';
    const boxes = list.map(t => {
      if (typeof t === 'string') return `<div class="ibox"><div class="text-sm font-medium">${t}</div></div>`;
      const pic = t.img ? img(t.img, t.name || 'TIP', 'thumb') : '';
      const meta = `${t.subtitle || (t.level != null ? 'Lv.'+t.level : '')}`;
      const text = `<div>${t.name ? `<div class="text-sm font-medium">${t.name}</div>` : ''}${meta ? `<div class="muted" style="font-size:12px">${meta}</div>` : ''}</div>`;
      const href = t.id ? `https://linsuol13-bit.github.io/LO/monster-${t.id}.html` : (t.link||t.url||'');
      return href ? `<a class="ibox" href="${href}">${pic}${text}</a>` : `<div class="ibox">${pic}${text}</div>`;
    }).join('');
    return `<section class="mb-10"><h2 class="text-sm font-semibold mb-2">TIP</h2><div class="grid">${boxes}</div></section>`;
  };

  const prereqSection = (list=[]) => {
    if (!Array.isArray(list) || !list.length) return '';
    const boxes = list.map(p => {
      const href = `https://linsuol13-bit.github.io/LO/quest-${p.id}.html`;
      return `<a class="ibox" href="${href}"><div class="text-sm"><div class="muted">선행 퀘스트</div><div class="font-medium">[${p.id}] ${p.title}</div></div></a>`;
    }).join('');
    return `<section class="mb-6"><h2 class="text-sm font-semibold mb-2">선행 퀘스트</h2><div class="grid">${boxes}</div></section>`;
  };

  const $detail = document.getElementById('detail');
  $detail.innerHTML = `
    <header class="mb-4">
      <h1 class="text-2xl font-bold">${q.code} · ${q.title}</h1>
      <p class="text-sm muted">${q.region} · ${q.type} · Lv.${q.minLevel}</p>
    </header>

    ${prereqSection(q.prereqs)}

    <section class="grid" style="grid-template-columns:1fr 1fr;">
      <div class="card">
        <h2 class="text-sm font-semibold mb-3">시작</h2>
        ${row('시작 NPC', q.start.npc.img, q.start.npc.name, '시작 장소', q.start.place.img, q.start.place.name, (q.start.npc.id?`https://linsuol13-bit.github.io/LO/npc-${q.start.npc.id}.html`:''), (q.start.place.code?`https://linsuol13-bit.github.io/LO/map-${q.start.place.code}.html`:''))}
      </div>
      <div class="card">
        <h2 class="text-sm font-semibold mb-3">완료</h2>
        ${row('완료 NPC', q.finish.npc.img, q.finish.npc.name, '완료 장소', q.finish.place.img, q.finish.place.name, (q.finish.npc.id?`https://linsuol13-bit.github.io/LO/npc-${q.finish.npc.id}.html`:''), (q.finish.place.code?`https://linsuol13-bit.github.io/LO/map-${q.finish.place.code}.html`:''))}
      </div>
    </section>

    <section class="mb-6">
      <h2 class="text-sm font-semibold mb-2">대사</h2>
      <div class="card" style="display:grid; gap:.5rem">
        ${(q.dialogues || []).map(dialogueRow).join('')}
      </div>
    </section>

    <section class="mb-6">
      <h2 class="text-sm font-semibold mb-2">퀘스트 조건</h2>
      <div class="card text-sm leading-relaxed text-gray-800 mb-3">${q.descHtml}</div>
      <div class="grid">
        ${(q.reqs || []).map(reqItemBox).join('')}
      </div>

      ${tipsSection(q.tips)}

      ${(q.completionDialogues && q.completionDialogues.length) ? `
      <div class="mt-4 pt-3 border-t">
        <h2 class="text-sm font-semibold mb-2">완료 대사</h2>
        <div class="card">${(q.completionDialogues || []).map(dialogueRow).join("")}</div>
      </div>` : ''}
    </section>

    ${(q.rewards && q.rewards.length) ? `
    <section class="mb-10">
      <h2 class="text-sm font-semibold mb-2">완료 보상</h2>
      <div class="grid">
        ${q.rewards.map(rewardBox).join('')}
      </div>
    </section>` : ''}
  `;
  // ---- Append Next Quest section via DOM ----
  try {
    if (Array.isArray(q.nexts) && q.nexts.length) {
      const nextSec = document.createElement('section');
      nextSec.className = 'mb-16';
      nextSec.innerHTML = `<h2 class="text-sm font-semibold mb-2">다음 퀘스트</h2>`;
      const grid = document.createElement('div');
      grid.className = 'grid';
      q.nexts.forEach(n => {
        const a = document.createElement('a');
        a.className = 'ibox';
        a.href = `quest-${n.id}.html`;
        a.innerHTML = `<div class="text-sm">
          <div class="muted">다음 퀘스트</div>
          <div class="font-medium">[${n.id}] ${n.title || ''}</div>
        </div>`;
        grid.appendChild(a);
      });
      nextSec.appendChild(grid);
      const detail = document.getElementById('detail');
      // Insert right after "완료 보상" if present; else append at end
      const h2s = detail.querySelectorAll('h2');
      let placed = false;
      h2s.forEach(h => {
        if (h.textContent.trim() === '완료 보상') {
          const sec = h.closest('section');
          if (sec && sec.parentNode) {
            sec.parentNode.insertBefore(nextSec, sec.nextSibling);
            placed = true;
          }
        }
      });
      if (!placed) detail.appendChild(nextSec);
    }
  } catch (e) { console.warn('Next quest append failed:', e); }

})();
</script>

<script>
(function(){
  var a = document.getElementById('back-to-quests');
  if(!a) return;
  a.addEventListener('click', function(e){
    e.preventDefault();
    try{
      var href = this.getAttribute('href') || 'index.html?tab=quests';
      var u = href + (href.indexOf('?')>-1 ? '&' : '?') + 'nocache=' + Date.now();
      location.replace(u);
    }catch(err){
      location.href = 'index.html?tab=quests';
    }
  });
})();
</script>

</body>
</html>
