
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>퀘스트 상세 • 로나월드</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Apple SD Gothic Neo", "Malgun Gothic", sans-serif; }
  .card { border:1px solid #e5e7eb; border-radius:0.75rem; background:#fff; padding:1rem; }
  .muted { color:#6b7280; }
  .row { display:flex; align-items:center; gap:.75rem; }
  .grid { display:grid; gap:1rem; }
  img { max-width:100%; height:auto; }
  .thumb { width:56px; height:56px; object-fit:contain; background:#fff; border:1px solid #e5e7eb; border-radius:0.5rem; padding:4px; }
  .ibox { display:flex; align-items:center; gap:.75rem; padding:.5rem; border:1px solid #e5e7eb; border-radius:0.75rem; background:#fff; }
  .ibox:hover { background:#f9fafb; }

  /* Speech bubbles */
  .bubble{position:relative;max-width:80%;padding:.625rem .75rem;border-radius:1rem;line-height:1.45;box-shadow:0 1px 2px rgba(0,0,0,.06)}
  .bubble-left{background:#f8fafc;border:1px solid #e5e7eb;color:#111827}
  .bubble-right{background:#3b82f6;border:1px solid #1d4ed8;color:#fff}
  .bubble-left:after{content:"";position:absolute;left:-6px;top:12px;border-width:6px;border-style:solid;border-color:transparent #e5e7eb transparent transparent}
  .bubble-left:before{content:"";position:absolute;left:-5px;top:12px;border-width:6px;border-style:solid;border-color:transparent #f8fafc transparent transparent}
  .bubble-right:after{content:"";position:absolute;right:-6px;top:12px;border-width:6px;border-style:solid;border-color:transparent transparent transparent #1d4ed8}
  .bubble-right:before{content:"";position:absolute;right:-5px;top:12px;border-width:6px;border-style:solid;border-color:transparent transparent transparent #3b82f6}
  .bubble-name{font-weight:600;font-size:.875rem;margin-bottom:.125rem}
  .avatar{width:40px;height:40px;border-radius:9999px;border:1px solid #e5e7eb;object-fit:cover;background:#fff}
  .bubble-right .bubble-name{color:#eaf2ff}
  .bubble-right a{color:#fff;text-decoration:underline}
  .bubble-right b,.bubble-right strong{color:#fff}
</style>
</head>
<body class="bg-gray-50 text-gray-900">
<div class="mx-auto max-w-5xl p-4 sm:p-6 lg:p-8">
<a class="inline-flex items-center gap-1 text-sm mb-4 text-blue-600 hover:underline" href="index.html?tab=quests" id="back-to-quests">← 퀘스트 목록으로</a>
<article id="detail"></article>
</div>

<script>
(() => {
  'use strict';
  const IMG = {
    bruce: "https://drive.google.com/thumbnail?id=192LWAkab2bHFBmoP1O_Dj0trz0x2-MKj&sz=w256",
    iyan: "https://drive.google.com/thumbnail?id=1Qh6RmsnBctbFC6zhtyAVOFCUVMPYiJtw&sz=w256",
    henesys: "https://drive.google.com/thumbnail?id=1-mGJYGjekTQwGtgcRY5ip2iL1D7uXp7E&sz=1700x668",
    perion: "https://drive.google.com/thumbnail?id=1nbA7-aR6XfVWbgFVh6jJo7czfta-LmDt&sz=1700x668",
    toy: "https://drive.google.com/thumbnail?id=1BwyPTo3zGoZK_9U3m0XE7WZpNe2KQyCJ&sz=w256",
  };

  const q = {
  "id": "21706",
  "code": "아란 6-2",
  "title": "정보원의 일",
  "type": "퀘스트 완료",
  "region": "리스항구",
  "minLevel": 10,
  "start": {
    "npc": {
      "name": "트루",
      "img": "https://drive.google.com/thumbnail?id=1zBYuyLSpPzu5TN_VeSYOcGv8utbMOnCV&sz=w400",
      "id": "1002104"
    },
    "place": {
      "name": "리스항구 정보상점",
      "img": "https://drive.google.com/thumbnail?id=14oqcw8cbRUt8UY7IUtRKnBzDFW5tpxdS&sz=w800",
      "code": "104000004"
    }
  },
  "finish": {
    "npc": {
      "name": "트루",
      "img": "https://drive.google.com/thumbnail?id=1zBYuyLSpPzu5TN_VeSYOcGv8utbMOnCV&sz=w400",
      "id": "1002104"
    },
    "place": {
      "name": "리스항구 정보상점",
      "img": "https://drive.google.com/thumbnail?id=14oqcw8cbRUt8UY7IUtRKnBzDFW5tpxdS&sz=w800",
      "code": "104000004"
    }
  },
  "dialogues": [
    {
      "who": "트루",
      "text": "그나저나, 영웅님. 당신의 목적이 세상을 배우며 수련해서 경험을 쌓는 거라면 정말 잘 왔어. 정보상인의 정보원만큼 그 목적에 적합한 일도 없는 것 같거든. 정보원의 일이 뭐냐고? 그건 간단해."
    },
    {
      "who": "트루",
      "text": "각 지역이나 사람들의 소문을 모아 놓았다가 그 정보를 원하는 사람에게 판매하는 게 정보상인의 일인데, 그 중에서 소문을 모으는 게 정보원의 일이야. 아, 이렇게 설명하지 말고 직접 한 번 해볼까?"
    },
    {
      "who": "트루",
      "text": "리스항구 왼편에 혹시 테오라는 사람을 보지 못했어? 꽤나 유명한 선원인데, 그에게 가서 최근 선원들에게 도는 소문에 대해 알아봐줘. 자, 그럼 부탁할게."
    }
  ],
  "completionDialogues": [
    {
      "who": "트루",
      "text": "테오에게 정보는 구해 온 거야? 자, 선원들에게 도는 소문에 대해 이야기 해줘."
    },
    {
      "who": "트루",
      "text": "좋아, 그 정도면 충분해. 간단하지? 이런 식으로 하나씩 정보를 모으는 게 정보원의 일이야."
    },
    {
      "who": "트루",
      "text": "당신에게는 정보원의 소질이 있는 것 같아. 이런 식으로 하다보면 금방 경험을 쌓을 수 있을 거야. 자 그럼 바로 다음 일로 넘어가 볼까?"
    }
  ],
  "descHtml": "트루는 정보원만큼 세상을 알기 좋은 일도 없다며, 정보수집 일을 해보자고 말했다. 그러면서 트루는 정보원의 일을 알기 위한 간단한 퀘스트를 주는데... 테오에게 가서 최근 선원들에게 도는 소문을 조사한 후, 트루에게 돌아가 보고하면 된다.",
  "reqs": [],
  "tips": [],
  "rewards": [
    {
      "exp": 4340,
      "img": "https://drive.google.com/thumbnail?id=1O9FuxyZEG_nZVJikWShUPKvb5zCH7t-z&sz=w400"
    }
  ],
  "prereqs": [
    {
      "id": "21705",
      "title": "빅토리아 아일랜드로"
    }
  ],
  "followups": [
    {
      "id": "21707",
      "title": "테오의 정보"
    }
  ]
};

  const img = (src, alt='', cls='') => `<img src="${src||''}" alt="${alt||''}" ${cls?`class="${cls}"`:''} onerror="this.style.display='none'">`;

  const row = (labelLeft, imgLeft, nameLeft, labelRight, imgRight, nameRight, linkLeft='', linkRight='') => {
    const cell = (label, imgSrc, name, link) => {
      const inner = `${img(imgSrc, name)}<div class="text-sm"><div class="muted">${label}</div><div class="font-medium">${name||'-'}</div></div>`;
      return link ? `<a class="row" href="${link}">${inner}</a>` : `<div class="row">${inner}</div>`;
    };
    return `<div class="row">${cell(labelLeft, imgLeft, nameLeft, linkLeft)}<div class="muted" style="padding:0 .5rem">|</div>${cell(labelRight, imgRight, nameRight, linkRight)}</div>`;
  };

  const rewardBox = r => {
    if (typeof r.exp === 'number') {
      const pic = img(r.img, 'EXP', 'thumb');
      const txt = `<div class="text-sm font-medium">경험치 ${r.exp.toLocaleString()} exp</div>`;
      return `<div class="ibox">${pic}${txt}</div>`;
    }
    const title = `${r.name||''}${(r.qty && r.qty>0) ? ' ×'+r.qty : ''}`;
    const pic = img(r.img, r.name, 'thumb');
    const inner = `<div class="text-sm font-medium">${title}</div>`;
    return r.itemId ? `<a class="ibox" href="https://linsuol13-bit.github.io/LO/item-${r.itemId}.html">${pic}${inner}</a>` : `<div class="ibox">${pic}${inner}</div>`;
  };

  
const reqItemBox = r => {
  const qtyPart = (r.qty && r.qty>0) ? (' ×'+r.qty) : (r.qty===0 ? ' (전달)' : (r.qty<0 ? ' (사용)' : ''));
  const title = `${r.name}${qtyPart}`;
  const pic = img(r.img, r.name, 'thumb');
  const inner = `<div class="text-sm font-medium">${title}</div>`;
  let href = '';
  if (r.itemId) {
    const t = (r.type||'');
    if (t.includes('몬스터')) href = `https://linsuol13-bit.github.io/LO/monster-${r.itemId}.html`;
    else if (t.includes('아이템')) href = `https://linsuol13-bit.github.io/LO/item-${r.itemId}.html`;
  }
  return href ? `<a class="ibox" href="${href}">${pic}${inner}</a>` : `<div class="ibox">${pic}${inner}</div>`;
};
        

  const isPlayer = (w) => /^(나|플레이어|주인공|Player|영웅)$/i.test((w||'').toString().trim());
  const avatarFor = (who) => {
    if (who === (q.start.npc && q.start.npc.name)) return q.start.npc.img;
    if (who === (q.finish.npc && q.finish.npc.name)) return q.finish.npc.img;
    return '';
  };
  const dialogueRow = (d) => {
    d = d || { };
    const left = !isPlayer(d.who);
    const av = left ? avatarFor(d.who) : '';
    const avatar = (left && av) ? `<img class="avatar" src="${av}" alt="${d.who||''}" onerror="this.style.display='none'">` : '';
    return `<div class="flex items-start ${left ? 'justify-start' : 'justify-end'} gap-2">${left ? avatar : ''}<div class="bubble ${left ? 'bubble-left' : 'bubble-right'}"><div class="bubble-name">${d.who||''}</div><div class="text-sm leading-snug">${d.text||''}</div></div></div>`;
  };

  const tipsSection = (tips=[]) => {
    const list = Array.isArray(tips) ? tips : [];
    if (!list.length) return '';
    const boxes = list.map(t => {
      if (typeof t === 'string') return `<div class="ibox"><div class="text-sm font-medium">${t}</div></div>`;
      const pic = t.img ? img(t.img, t.name || 'TIP', 'thumb') : '';
      const meta = `${t.subtitle || (t.level != null ? 'Lv.'+t.level : '')}`;
      const text = `<div>${t.name ? `<div class="text-sm font-medium">${t.name}</div>` : ''}${meta ? `<div class="muted" style="font-size:12px">${meta}</div>` : ''}</div>`;
      const href = t.id ? `https://linsuol13-bit.github.io/LO/monster-${t.id}.html` : (t.link||t.url||'');
      return href ? `<a class="ibox" href="${href}">${pic}${text}</a>` : `<div class="ibox">${pic}${text}</div>`;
    }).join('');
    return `<section class="mb-10"><h2 class="text-sm font-semibold mb-2">TIP</h2><div class="grid">${boxes}</div></section>`;
  };

  const prereqSection = (list=[]) => {
    if (!Array.isArray(list) || !list.length) return '';
    const boxes = list.map(p => {
      const href = `https://linsuol13-bit.github.io/LO/quest-${p.id}.html`;
      return `<a class="ibox" href="${href}"><div class="text-sm"><div class="muted">선행 퀘스트</div><div class="font-medium">[${p.id}] ${p.title}</div></div></a>`;
    }).join('');
    return `<section class="mb-6"><h2 class="text-sm font-semibold mb-2">선행 퀘스트</h2><div class="grid">${boxes}</div></section>`;
  };
// Linked quests renderer (safe location before render)
function linkedQuestsSection(list) {
  if (!list || !list.length) return '';
  try {
    const items = list.map(f => {
      const id = (f && (f.id || f.questId)) || '';
      const title = (f && f.title) || '';
      const href = `quest-${id}.html`;
      return `<a class="ibox" href="${href}"><div class="text-sm font-medium">[${id}] ${title}</div></a>`;
    }).join('');
    return `
      <section class="mt-6">
        <h2 class="text-sm font-semibold mb-2">연계퀘스트</h2>
        <div class="iboxes">${items}</div>
      </section>
    `;
  } catch (e) {
    return '';
  }
}


  const $detail = document.getElementById('detail');
  $detail.innerHTML = `
    <header class="mb-4">
      <h1 class="text-2xl font-bold">${q.code} · ${q.title}</h1>
      <p class="text-sm muted">${q.region} · ${q.type} · Lv.${q.minLevel}</p>
    </header>

    ${prereqSection(q.prereqs)}

    <section class="grid" style="grid-template-columns:1fr 1fr;">
      <div class="card">
        <h2 class="text-sm font-semibold mb-3">시작</h2>
        ${row('시작 NPC', q.start.npc.img, q.start.npc.name, '시작 장소', q.start.place.img, q.start.place.name, (q.start.npc.id?`https://linsuol13-bit.github.io/LO/npc-${q.start.npc.id}.html`:''), (q.start.place.code?`https://linsuol13-bit.github.io/LO/map-${q.start.place.code}.html`:''))}
      </div>
      <div class="card">
        <h2 class="text-sm font-semibold mb-3">완료</h2>
        ${row('완료 NPC', q.finish.npc.img, q.finish.npc.name, '완료 장소', q.finish.place.img, q.finish.place.name, (q.finish.npc.id?`https://linsuol13-bit.github.io/LO/npc-${q.finish.npc.id}.html`:''), (q.finish.place.code?`https://linsuol13-bit.github.io/LO/map-${q.finish.place.code}.html`:''))}
      </div>
    </section>

    <section class="mb-6">
      <h2 class="text-sm font-semibold mb-2">대사</h2>
      <div class="card" style="display:grid; gap:.5rem">
        ${(q.dialogues || []).map(dialogueRow).join('')}
      </div>
    </section>

    <section class="mb-6">
      <h2 class="text-sm font-semibold mb-2">퀘스트 조건</h2>
      <div class="card text-sm leading-relaxed text-gray-800 mb-3">${q.descHtml}</div>
      <div class="grid">
        ${(q.reqs || []).map(reqItemBox).join('')}
      </div>

      ${tipsSection(q.tips)}

      ${linkedQuestsSection(q.followups)}

      ${(q.completionDialogues && q.completionDialogues.length) ? `
      <div class="mt-4 pt-3 border-t">
        <h2 class="text-sm font-semibold mb-2">완료 대사</h2>
        <div class="card">${(q.completionDialogues || []).map(dialogueRow).join("")}</div>
      </div>` : ''}
    </section>

    ${(q.rewards && q.rewards.length) ? `
    <section class="mb-10">
      <h2 class="text-sm font-semibold mb-2">완료 보상</h2>
      <div class="grid">
        ${q.rewards.map(rewardBox).join('')}
      </div>
    </section>` : ''}
  `;
})();
</script>

<script>
(function(){
  var a = document.getElementById('back-to-quests');
  if(!a) return;
  a.addEventListener('click', function(e){
    e.preventDefault();
    try{
      var href = this.getAttribute('href') || 'index.html?tab=quests';
      var u = href + (href.indexOf('?')>-1 ? '&' : '?') + 'nocache=' + Date.now();
      location.replace(u);
    }catch(err){
      location.href = 'index.html?tab=quests';
    }
  });
})();
</script>

</body>
</html>
