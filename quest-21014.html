
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>퀘스트 상세 • 로나월드</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Apple SD Gothic Neo", "Malgun Gothic", sans-serif; }
  .card { border:1px solid #e5e7eb; border-radius:0.75rem; background:#fff; padding:1rem; }
  .muted { color:#6b7280; }
  .row { display:flex; align-items:center; gap:.75rem; }
  .grid { display:grid; gap:1rem; }
  img { max-width:100%; height:auto; }
  .thumb { width:56px; height:56px; object-fit:contain; background:#fff; border:1px solid #e5e7eb; border-radius:0.5rem; padding:4px; }
  .ibox { display:flex; align-items:center; gap:.75rem; padding:.5rem; border:1px solid #e5e7eb; border-radius:0.75rem; background:#fff; }
  .ibox:hover { background:#f9fafb; }

  /* Speech bubbles */
  .bubble{position:relative;max-width:80%;padding:.625rem .75rem;border-radius:1rem;line-height:1.45;box-shadow:0 1px 2px rgba(0,0,0,.06)}
  .bubble-left{background:#f8fafc;border:1px solid #e5e7eb;color:#111827}
  .bubble-right{background:#3b82f6;border:1px solid #1d4ed8;color:#fff}
  .bubble-left:after{content:"";position:absolute;left:-6px;top:12px;border-width:6px;border-style:solid;border-color:transparent #e5e7eb transparent transparent}
  .bubble-left:before{content:"";position:absolute;left:-5px;top:12px;border-width:6px;border-style:solid;border-color:transparent #f8fafc transparent transparent}
  .bubble-right:after{content:"";position:absolute;right:-6px;top:12px;border-width:6px;border-style:solid;border-color:transparent transparent transparent #1d4ed8}
  .bubble-right:before{content:"";position:absolute;right:-5px;top:12px;border-width:6px;border-style:solid;border-color:transparent transparent transparent #3b82f6}
  .bubble-name{font-weight:600;font-size:.875rem;margin-bottom:.125rem}
  .avatar{width:40px;height:40px;border-radius:9999px;border:1px solid #e5e7eb;object-fit:cover;background:#fff}
  .bubble-right .bubble-name{color:#eaf2ff}
  .bubble-right a{color:#fff;text-decoration:underline}
  .bubble-right b,.bubble-right strong{color:#fff}
</style>
</head>
<body class="bg-gray-50 text-gray-900">
<div class="mx-auto max-w-5xl p-4 sm:p-6 lg:p-8">
<a class="inline-flex items-center gap-1 text-sm mb-4 text-blue-600 hover:underline" href="index.html?tab=quests" id="back-to-quests">← 퀘스트 목록으로</a>
<article id="detail"></article>
</div>

<script>
(() => {
  'use strict';
  const IMG = {
    bruce: "https://drive.google.com/thumbnail?id=192LWAkab2bHFBmoP1O_Dj0trz0x2-MKj&sz=w256",
    iyan: "https://drive.google.com/thumbnail?id=1Qh6RmsnBctbFC6zhtyAVOFCUVMPYiJtw&sz=w256",
    henesys: "https://drive.google.com/thumbnail?id=1-mGJYGjekTQwGtgcRY5ip2iL1D7uXp7E&sz=1700x668",
    perion: "https://drive.google.com/thumbnail?id=1nbA7-aR6XfVWbgFVh6jJo7czfta-LmDt&sz=1700x668",
    toy: "https://drive.google.com/thumbnail?id=1BwyPTo3zGoZK_9U3m0XE7WZpNe2KQyCJ&sz=w256",
  };

  const q = {
  "id": "21014",
  "code": "아란 3-1",
  "title": "리린의 이야기",
  "type": "대화",
  "region": "리엔",
  "minLevel": 5,
  "start": {
    "npc": {
      "name": "리린",
      "img": "https://drive.google.com/thumbnail?id=1gmTm8r-9Jf9dru1TOsTAWRaCueh3tvb4&sz=w400",
      "id": "1201000"
    },
    "place": {
      "name": "리엔",
      "img": "https://drive.google.com/thumbnail?id=1-Vur3U1Jw-nQaOLTLIHEOuPkcR5E4EWY&sz=w800",
      "code": "140000000"
    }
  },
  "finish": {
    "npc": {
      "name": "리린",
      "img": "https://drive.google.com/thumbnail?id=1gmTm8r-9Jf9dru1TOsTAWRaCueh3tvb4&sz=w400",
      "id": "1201000"
    },
    "place": {
      "name": "리엔",
      "img": "https://drive.google.com/thumbnail?id=1-Vur3U1Jw-nQaOLTLIHEOuPkcR5E4EWY&sz=w800",
      "code": "140000000"
    }
  },
  "dialogues": [
    {
      "who": "리린",
      "text": "얼음 동굴 안에서 깨어나 기억나는 것은 아무것도 없는 상황. 거기에 당신을 영웅이라고 부르는 나까지... 많이 혼란스러우셨죠? 그럼 이제부터 당신과 당신을 둘러싼 이 상황에 대해 자세히 설명해 드릴게요."
    },
    {
      "who": "리린",
      "text": "수백 년 전... 세계는, 메이플 월드는 검은 마법사의 손아귀에 놓여 있었습니다. 사악한 검은 마법사는 그의 가진 어둠의 힘으로 메이플 월드를 점점 멸망의 길로 몰아넣었고 거의 성공 직전에 이르렀어요."
    },
    {
      "who": "리린",
      "text": "검은 마법사를 막기 위해 사람들은 애를 썼지만 모두 실패했어요. 멸망이 눈 앞에 다가오자 몇 명의 용기 있는 사람들은 결단을 내렸죠. 싸울 수 없는 일반인과 부상자를 피신시키고 오직 자신들만이 남아 검은 마법사와의 결전을 벌이기로..."
    },
    {
      "who": "리린",
      "text": "그 싸움의 끝은 전해지지 않아요. 분명한 건 하나에요. 검은 마법사는 봉인되었고 희생을 치른 영웅들은 사라졌다는 것... 그리고 메이플 월드에는 평화가 차장왔다는 것... 그뿐이죠. 사람들은 금새 영웅들을 잊고 말았어요."
    },
    {
      "who": "리린",
      "text": "많은 시간이 흐른 뒤, 한 예언서가 나타났어요. 이 책에 의하면, 마지막 전투에서 모든 힘을 잃은 검은 마법사는 영웅들에게 최후의 저주를 걸었다고 해요. 모든 기억과 능력을 잃고 얼음 속에서 수백 년 동안 잠이 들 것이라고..."
    },
    {
      "who": "리린",
      "text": "많은 사람들은 그 예언서가 가짜라고 말했지만 한 일족만큼은 예언서를 진실이라 믿고 예언을 연구해왔죠. 난 그 일족의 마지막 후계짜에요. 그래서 이 섬에서 기다리고 있었죠. 언젠가 얼음에 갇혔던 영웅들이 되돌아 올 것을..."
    },
    {
      "who": "리린",
      "text": "그리고 드디어 만나게 되었어요. 예언 속의 영웅, 메이플 월드를 구했지만 수백 년의 세월이 흐르는 동안 사람들의 기억 속에 잊혀져 버린 영웅을... 그리고 다시 한 번 메이플 월드를 구할... 바로 당신을 말이에요. 이해하셨나요?"
    },
    {
      "who": "리린",
      "text": "정말 이해하신 건가요? 표정이 멍한데... 흥. 그렇다면 좋아요. 제대로 이해하셨는지 한 번 테스트 해볼게요. 준비가 되면 말을 걸어주세요."
    }
  ],
  "completionDialogues": [
    {
      "who": "리린",
      "text": "제 이야기를 제대로 들으셨는지 한 번 테스트해 볼게요. 잘 듣고 묻는 말에 정확한 대답을 해주시면 돼요. 자, 첫 번째 문제예요. 수백 년전, 메이플 월드를 지배한 어둠의 힘을 가진 마법사를 뭐라고 부르나요"
    },
    {
      "who": "플레이어",
      "text": "검은 마법사"
    },
    {
      "who": "리린",
      "text": "두 번째 문제에요. 영웅, 즉 당신들은 일반인과 부상자를 피난시키고 검은 마법사와의 마지막 결전을 치르기로 결단을 내렸어요. 그 결과는 한 예언서에 의해 밝혀졌죠. 검은 마법사와의 마지막 결전 결전 결과를 말해보세요"
    },
    {
      "who": "플레이어",
      "text": "검은 마법사를 봉인했다"
    },
    {
      "who": "리린",
      "text": "마지막 문제를 드릴게요. 지금 메이플 월드는 평화로워 보이지만 사실 혼란에 빠져 있어요ㅣ. 검은 마법사가 다시 나타날 거라는 소문이 돌고 있거든요. 검은 마법사가 깨어난다면 이번에야 말로 메이플 월드는 멸망하고 말 거예요. 이때 당신이 해야 할 일은 뭘까요?"
    },
    {
      "who": "플레이어",
      "text": "검은 마법사를 물리치고 메이플 월드를 지킨다"
    },
    {
      "who": "리린",
      "text": "잘 알고 계시는군요. 기억과 능력을 잃었대도 역시 영웅... 기대를 저버리지 않는군요."
    },
    {
      "who": "리린",
      "text": "예언서 역시 영웅이 돌아와 다시 한 번 검은 마법사를 물리칠 거라고 말하고 있어요. 당신은 다시 한 번 검은 마법사와 싸우게 될 거예요. 메이플 월드의 운명을 걸고..."
    }
  ],
  "descHtml": "리린의 말에 의하면 수백 년 전, 메이플 월드를 지배하던 검은 마법사에게 맞서 싸운 영웅들이 있었으며, 그 중의 한 명이 나인 것 같다. 검은 마법사의 저주로 인해 모든 기억과 능력을 잃고 얼음 속에 잠들어 있다가 깨어난 것이라는데...<br>리린이 이와 같은 사실을 알고 있는 이유는 그들 일족에 전해져 내려온 예언 때문이라고 한다. 예언에 의하면 다시 한 번 검은 마법사가 메이플 월드를 지배하기 전에, 영웅을 깨워 그것을 막아야 한다는데...",
  "reqs": [],
  "tips": [],
  "rewards": [
    {
      "exp": 980,
      "img": "https://drive.google.com/thumbnail?id=1O9FuxyZEG_nZVJikWShUPKvb5zCH7t-z&sz=w400"
    }
  ],
  "prereqs": [],
  "followups": [],
  "nexts": [ { "id": "21015", "title": "기초 체력 단련 1" } ]
};

  const img = (src, alt='', cls='') => `<img src="${src||''}" alt="${alt||''}" ${cls?`class="${cls}"`:''} onerror="this.style.display='none'">`;

  const row = (labelLeft, imgLeft, nameLeft, labelRight, imgRight, nameRight, linkLeft='', linkRight='') => {
    const cell = (label, imgSrc, name, link) => {
      const inner = `${img(imgSrc, name)}<div class="text-sm"><div class="muted">${label}</div><div class="font-medium">${name||'-'}</div></div>`;
      return link ? `<a class="row" href="${link}">${inner}</a>` : `<div class="row">${inner}</div>`;
    };
    return `<div class="row">${cell(labelLeft, imgLeft, nameLeft, linkLeft)}<div class="muted" style="padding:0 .5rem">|</div>${cell(labelRight, imgRight, nameRight, linkRight)}</div>`;
  };

  const rewardBox = r => {
    if (typeof r.exp === 'number') {
      const pic = img(r.img, 'EXP', 'thumb');
      const txt = `<div class="text-sm font-medium">경험치 ${r.exp.toLocaleString()} exp</div>`;
      return `<div class="ibox">${pic}${txt}</div>`;
    }
    const title = `${r.name||''}${(r.qty && r.qty>0) ? ' ×'+r.qty : ''}`;
    const pic = img(r.img, r.name, 'thumb');
    const inner = `<div class="text-sm font-medium">${title}</div>`;
    return r.itemId ? `<a class="ibox" href="https://linsuol13-bit.github.io/LO/item-${r.itemId}.html">${pic}${inner}</a>` : `<div class="ibox">${pic}${inner}</div>`;
  };

  
const reqItemBox = r => {
  const qtyPart = (r.qty && r.qty>0) ? (' ×'+r.qty) : (r.qty===0 ? ' (전달)' : (r.qty<0 ? ' (사용)' : ''));
  const title = `${r.name}${qtyPart}`;
  const pic = img(r.img, r.name, 'thumb');
  const inner = `<div class="text-sm font-medium">${title}</div>`;
  let href = '';
  if (r.itemId) {
    const t = (r.type||'');
    if (t.includes('몬스터')) href = `https://linsuol13-bit.github.io/LO/monster-${r.itemId}.html`;
    else if (t.includes('아이템')) href = `https://linsuol13-bit.github.io/LO/item-${r.itemId}.html`;
  }
  return href ? `<a class="ibox" href="${href}">${pic}${inner}</a>` : `<div class="ibox">${pic}${inner}</div>`;
};
    

  const isPlayer = (w) => /^(나|플레이어|주인공|Player|영웅)$/i.test((w||'').toString().trim());
  const avatarFor = (who) => {
    if (who === (q.start.npc && q.start.npc.name)) return q.start.npc.img;
    if (who === (q.finish.npc && q.finish.npc.name)) return q.finish.npc.img;
    return '';
  };
  const dialogueRow = (d) => {
    d = d || { };
    const left = !isPlayer(d.who);
    const av = left ? avatarFor(d.who) : '';
    const avatar = (left && av) ? `<img class="avatar" src="${av}" alt="${d.who||''}" onerror="this.style.display='none'">` : '';
    return `<div class="flex items-start ${left ? 'justify-start' : 'justify-end'} gap-2">${left ? avatar : ''}<div class="bubble ${left ? 'bubble-left' : 'bubble-right'}"><div class="bubble-name">${d.who||''}</div><div class="text-sm leading-snug">${d.text||''}</div></div></div>`;
  };

  const tipsSection = (tips=[]) => {
    const list = Array.isArray(tips) ? tips : [];
    if (!list.length) return '';
    const boxes = list.map(t => {
      if (typeof t === 'string') return `<div class="ibox"><div class="text-sm font-medium">${t}</div></div>`;
      const pic = t.img ? img(t.img, t.name || 'TIP', 'thumb') : '';
      const meta = `${t.subtitle || (t.level != null ? 'Lv.'+t.level : '')}`;
      const text = `<div>${t.name ? `<div class="text-sm font-medium">${t.name}</div>` : ''}${meta ? `<div class="muted" style="font-size:12px">${meta}</div>` : ''}</div>`;
      const href = t.id ? `https://linsuol13-bit.github.io/LO/monster-${t.id}.html` : (t.link||t.url||'');
      return href ? `<a class="ibox" href="${href}">${pic}${text}</a>` : `<div class="ibox">${pic}${text}</div>`;
    }).join('');
    return `<section class="mb-10"><h2 class="text-sm font-semibold mb-2">TIP</h2><div class="grid">${boxes}</div></section>`;
  };

  const prereqSection = (list=[]) => {
    if (!Array.isArray(list) || !list.length) return '';
    const boxes = list.map(p => {
      const href = `https://linsuol13-bit.github.io/LO/quest-${p.id}.html`;
      return `<a class="ibox" href="${href}"><div class="text-sm"><div class="muted">선행 퀘스트</div><div class="font-medium">[${p.id}] ${p.title}</div></div></a>`;
    }).join('');
    return `<section class="mb-6"><h2 class="text-sm font-semibold mb-2">선행 퀘스트</h2><div class="grid">${boxes}</div></section>`;
  };

  const $detail = document.getElementById('detail');
  $detail.innerHTML = `
    <header class="mb-4">
      <h1 class="text-2xl font-bold">${q.code} · ${q.title}</h1>
      <p class="text-sm muted">${q.region} · ${q.type} · Lv.${q.minLevel}</p>
    </header>

    ${prereqSection(q.prereqs)}

    <section class="grid" style="grid-template-columns:1fr 1fr;">
      <div class="card">
        <h2 class="text-sm font-semibold mb-3">시작</h2>
        ${row('시작 NPC', q.start.npc.img, q.start.npc.name, '시작 장소', q.start.place.img, q.start.place.name, (q.start.npc.id?`https://linsuol13-bit.github.io/LO/npc-${q.start.npc.id}.html`:''), (q.start.place.code?`https://linsuol13-bit.github.io/LO/map-${q.start.place.code}.html`:''))}
      </div>
      <div class="card">
        <h2 class="text-sm font-semibold mb-3">완료</h2>
        ${row('완료 NPC', q.finish.npc.img, q.finish.npc.name, '완료 장소', q.finish.place.img, q.finish.place.name, (q.finish.npc.id?`https://linsuol13-bit.github.io/LO/npc-${q.finish.npc.id}.html`:''), (q.finish.place.code?`https://linsuol13-bit.github.io/LO/map-${q.finish.place.code}.html`:''))}
      </div>
    </section>

    <section class="mb-6">
      <h2 class="text-sm font-semibold mb-2">대사</h2>
      <div class="card" style="display:grid; gap:.5rem">
        ${(q.dialogues || []).map(dialogueRow).join('')}
      </div>
    </section>

    <section class="mb-6">
      <h2 class="text-sm font-semibold mb-2">퀘스트 조건</h2>
      <div class="card text-sm leading-relaxed text-gray-800 mb-3">${q.descHtml}</div>
      <div class="grid">
        ${(q.reqs || []).map(reqItemBox).join('')}
      </div>

      ${tipsSection(q.tips)}

      ${(q.completionDialogues && q.completionDialogues.length) ? `
      <div class="mt-4 pt-3 border-t">
        <h2 class="text-sm font-semibold mb-2">완료 대사</h2>
        <div class="card">${(q.completionDialogues || []).map(dialogueRow).join("")}</div>
      </div>` : ''}
    </section>

    ${(q.rewards && q.rewards.length) ? `
    <section class="mb-10">
      <h2 class="text-sm font-semibold mb-2">완료 보상</h2>
      <div class="grid">
        ${q.rewards.map(rewardBox).join('')}
      </div>
    </section>` : ''}
  `;
  // ---- Append Next Quest section via DOM ----
  try {
    if (Array.isArray(q.nexts) && q.nexts.length) {
      const nextSec = document.createElement('section');
      nextSec.className = 'mb-16';
      nextSec.innerHTML = `<h2 class="text-sm font-semibold mb-2">다음 퀘스트</h2>`;
      const grid = document.createElement('div');
      grid.className = 'grid';
      q.nexts.forEach(n => {
        const a = document.createElement('a');
        a.className = 'ibox';
        a.href = `quest-${n.id}.html`;
        a.innerHTML = `<div class="text-sm">
          <div class="muted">다음 퀘스트</div>
          <div class="font-medium">[${n.id}] ${n.title || ''}</div>
        </div>`;
        grid.appendChild(a);
      });
      nextSec.appendChild(grid);
      const detail = document.getElementById('detail');
      // Insert right after "완료 보상" section if present; else append at end
      const h2s = detail.querySelectorAll('h2');
      let placed = false;
      h2s.forEach(h => {
        if (h.textContent.trim() === '완료 보상') {
          const sec = h.closest('section');
          if (sec && sec.parentNode) {
            sec.parentNode.insertBefore(nextSec, sec.nextSibling);
            placed = true;
          }
        }
      });
      if (!placed) detail.appendChild(nextSec);
    }
  } catch (e) { console.warn('Next quest append failed:', e); }

})();
</script>

<script>
(function(){
  var a = document.getElementById('back-to-quests');
  if(!a) return;
  a.addEventListener('click', function(e){
    e.preventDefault();
    try{
      var href = this.getAttribute('href') || 'index.html?tab=quests';
      var u = href + (href.indexOf('?')>-1 ? '&' : '?') + 'nocache=' + Date.now();
      location.replace(u);
    }catch(err){
      location.href = 'index.html?tab=quests';
    }
  });
})();
</script>

</body>
</html>
